<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DÃ¼nya RadyolarÄ± OynatÄ±cÄ±sÄ± - GeliÅŸmiÅŸ</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --bg-light: #f4f7f6;
            --text-dark: #333;
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            padding-bottom: 100px; /* Player iÃ§in alt boÅŸluk */
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--secondary-color);
        }

        .search-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* KÃ¼Ã§Ã¼k ekranlarda alt alta gelmesi iÃ§in */
        }

        input[type="text"], select {
            padding: 12px;
            width: 200px; /* GeniÅŸlik ayarlandÄ± */
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            background-color: white; /* SeÃ§im kutularÄ± iÃ§in de arka plan */
            -webkit-appearance: none; /* iOS'ta varsayÄ±lan gÃ¶rÃ¼nÃ¼mÃ¼ kaldÄ±rmak iÃ§in */
            -moz-appearance: none; /* Firefox'ta varsayÄ±lan gÃ¶rÃ¼nÃ¼mÃ¼ kaldÄ±rmak iÃ§in */
            appearance: none; /* VarsayÄ±lan gÃ¶rÃ¼nÃ¼mÃ¼ kaldÄ±rmak iÃ§in */
            background-image: url('data:image/svg+xml;utf8,<svg fill="%233498db" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* Ã–zel ok simgesi */
            background-repeat: no-repeat;
            background-position: right 10px center;
        }
        
        input[type="text"] {
            width: 250px; /* Arama kutusu biraz daha geniÅŸ */
        }

        input[type="text"]:focus, select:focus {
            border-color: var(--primary-color);
        }

        button {
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        /* SonuÃ§ AlanÄ± ve Kartlar */
        #results-area {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .station-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .station-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border-left: 5px solid var(--primary-color);
        }

        .station-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .station-details {
            font-size: 0.9em;
            color: #666;
        }
        
        .station-details img {
            max-width: 20px;
            height: auto;
            vertical-align: middle;
            margin-right: 5px;
        }

        /* Sabit Alt OynatÄ±cÄ± */
        .fixed-player {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--secondary-color);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 100;
        }

        #current-station-info {
            margin-left: 20px;
            font-weight: bold;
            flex-grow: 1; /* Metnin daha fazla yer kaplamasÄ± iÃ§in */
            white-space: nowrap; /* Metni tek satÄ±rda tut */
            overflow: hidden; /* TaÅŸmayÄ± gizle */
            text-overflow: ellipsis; /* TaÅŸma durumunda Ã¼Ã§ nokta gÃ¶ster */
        }

        audio {
            width: 60%;
            min-width: 250px; /* Mobil uyumluluk iÃ§in */
            margin-right: 20px;
            outline: none;
        }
        
        .loading, .error {
            text-align: center;
            font-size: 1.2em;
            margin-top: 20px;
            width: 100%; /* Merkezleme iÃ§in */
        }
        .error { color: #e74c3c; }

        /* KÃ¼Ã§Ã¼k ekranlar iÃ§in dÃ¼zenlemeler */
        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
                align-items: center;
            }
            input[type="text"], select, button {
                width: 80%; /* Daha dar ekranlarda daha geniÅŸ */
                max-width: 350px;
            }
            .fixed-player {
                flex-direction: column;
                padding: 10px;
            }
            #current-station-info {
                margin-left: 0;
                margin-bottom: 10px;
                text-align: center;
            }
            audio {
                width: 90%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>DÃ¼nya Radyo Gezgini</h1>
        <p>Ä°stasyon adÄ±, Ã¼lke veya kategoriye gÃ¶re arama yapÄ±n.</p>
    </header>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Ä°stasyon adÄ± (opsiyonel)">
        <select id="country-select">
            <option value="">TÃ¼m Ãœlkeler</option>
            </select>
        <select id="category-select">
            <option value="">TÃ¼m Kategoriler</option>
            </select>
        <button onclick="searchStations()">Ara</button>
    </div>

    <div id="results-area">
        <p style="text-align: center; width: 100%;">Arama yapmak iÃ§in yukarÄ±daki seÃ§enekleri kullanÄ±n.</p>
    </div>

    <div class="fixed-player">
        <div id="current-station-info">Bir istasyon seÃ§in...</div>
        <audio id="radio-player" controls autoplay>
            TarayÄ±cÄ±nÄ±z audio elementini desteklemiyor.
        </audio>
    </div>


    <script>
        const resultsArea = document.getElementById('results-area');
        const audioPlayer = document.getElementById('radio-player');
        const currentStationInfo = document.getElementById('current-station-info');
        const searchInput = document.getElementById('search-input');
        const countrySelect = document.getElementById('country-select');
        const categorySelect = document.getElementById('category-select');

        // Sayfa yÃ¼klendiÄŸinde Ã¼lke ve kategori listelerini doldur
        document.addEventListener('DOMContentLoaded', () => {
            populateCountrySelect();
            populateCategorySelect();
        });

        // Enter tuÅŸu ile arama yapabilmek iÃ§in
        searchInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                searchStations();
            }
        });

        // API HatasÄ± durumunda oynatÄ±cÄ±yÄ± bilgilendir
        audioPlayer.onerror = function() {
            currentStationInfo.textContent = "Hata: Bu yayÄ±n ÅŸu anda aÃ§Ä±lamÄ±yor veya Ã§evrimdÄ±ÅŸÄ±.";
            currentStationInfo.style.color = "#e74c3c";
        };

        async function populateCountrySelect() {
            try {
                // Sadece geÃ§erli, aktif radyo istasyonlarÄ± olan Ã¼lkeleri getir
                const response = await fetch('https://de1.api.radio-browser.info/json/countries');
                if (!response.ok) throw new Error('Ãœlke listesi alÄ±namadÄ±.');
                const countries = await response.json();

                countries.sort((a, b) => a.name.localeCompare(b.name)); // Ãœlkeleri alfabetik sÄ±rala

                countries.forEach(country => {
                    if (country.stationcount > 0) { // En az bir istasyonu olan Ã¼lkeleri gÃ¶ster
                        const option = document.createElement('option');
                        option.value = country.name;
                        option.textContent = `${country.name} (${country.stationcount})`;
                        countrySelect.appendChild(option);
                    }
                });
            } catch (error) {
                console.error('Ãœlke listesi yÃ¼klenirken hata:', error);
            }
        }

        async function populateCategorySelect() {
            try {
                // Sadece geÃ§erli, aktif radyo istasyonlarÄ± olan etiketleri (kategorileri) getir
                const response = await fetch('https://de1.api.radio-browser.info/json/tags');
                if (!response.ok) throw new Error('Kategori listesi alÄ±namadÄ±.');
                const tags = await response.json();

                // Etiketleri en Ã§ok kullanÄ±lanlardan en aza doÄŸru sÄ±rala
                tags.sort((a, b) => b.stationcount - a.stationcount); 

                // Ä°lk 100 etiketi al (Ã§ok fazla etiket olabilir) veya daha az isterseniz ayarlayÄ±n
                tags.slice(0, 100).forEach(tag => { 
                    if (tag.stationcount > 0 && tag.name.length > 1) { // BoÅŸ veya Ã§ok kÄ±sa etiketleri filtrele
                        const option = document.createElement('option');
                        option.value = tag.name;
                        option.textContent = `${tag.name} (${tag.stationcount})`;
                        categorySelect.appendChild(option);
                    }
                });
            } catch (error) {
                console.error('Kategori listesi yÃ¼klenirken hata:', error);
            }
        }

        async function searchStations() {
            const query = searchInput.value.trim();
            const selectedCountry = countrySelect.value;
            const selectedCategory = categorySelect.value;

            // En az bir arama kriteri olmalÄ±
            if (query === "" && selectedCountry === "" && selectedCategory === "") {
                alert("LÃ¼tfen bir arama terimi girin veya Ã¼lke/kategori seÃ§in.");
                return;
            }

            resultsArea.innerHTML = '<div class="loading">Ä°stasyonlar aranÄ±yor...</div>';
            
            // API isteÄŸi URL'sini oluÅŸtur
            let apiUrl = 'https://de1.api.radio-browser.info/json/stations/search';
            let params = [];

            if (query) {
                params.push(`name=${encodeURIComponent(query)}`);
            }
            if (selectedCountry) {
                params.push(`country=${encodeURIComponent(selectedCountry)}`);
            }
            if (selectedCategory) {
                params.push(`tag=${encodeURIComponent(selectedCategory)}`);
            }

            // Arama sonuÃ§larÄ±nÄ± popÃ¼lerliÄŸe gÃ¶re (clickcount) tersten sÄ±rala
            params.push(`order=clickcount`);
            params.push(`reverse=true`);
            params.push(`limit=50`); // Daha fazla sonuÃ§ getirebiliriz
            params.push(`hidebroken=true`); // Ã‡alÄ±ÅŸmayan istasyonlarÄ± gizle

            apiUrl += `?${params.join('&')}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('AÄŸ hatasÄ± oluÅŸtu.');
                const data = await response.json();
                
                displayResults(data);
            } catch (error) {
                resultsArea.innerHTML = `<div class="error">Bir hata oluÅŸtu: ${error.message}. LÃ¼tfen tekrar deneyin.</div>`;
                console.error('API HatasÄ±:', error);
            }
        }

        function displayResults(stations) {
            resultsArea.innerHTML = ''; // Ã–nceki sonuÃ§larÄ± temizle

            if (stations.length === 0) {
                resultsArea.innerHTML = '<p style="text-align: center; width: 100%;">Kriterlere uygun istasyon bulunamadÄ±.</p>';
                return;
            }

            stations.forEach(station => {
                const card = document.createElement('div');
                card.className = 'station-card';
                
                const name = station.name || 'Bilinmeyen Ä°stasyon';
                const country = station.country || 'DÃ¼nya';
                const tags = station.tags ? station.tags.split(',').filter(tag => tag.trim() !== '').slice(0, 3).join(', ') : ''; // Ä°lk 3 etiketi gÃ¶ster
                const bitrate = station.bitrate ? `${station.bitrate} kbps` : '';
                const favicon = station.favicon && station.favicon.startsWith('http') ? station.favicon : ''; // GÃ¼venli favicon kontrolÃ¼

                card.innerHTML = `
                    <div>
                        <div class="station-name">${favicon ? `<img src="${favicon}" alt="logo" loading="lazy"> ` : ''}${name}</div>
                        <div class="station-details">ğŸ“ ${country}</div>
                        ${tags ? `<div class="station-details">ğŸ·ï¸ ${tags}</div>` : ''}
                    </div>
                    <div class="station-details" style="text-align: right; margin-top: 10px;">
                         ğŸ”Š ${bitrate}
                    </div>
                `;

                card.addEventListener('click', () => {
                    playStream(station.url_resolved, name);
                });

                resultsArea.appendChild(card);
            });
        }

        function playStream(url, name) {
            currentStationInfo.style.color = "white";
            currentStationInfo.textContent = `Ã‡alÄ±nÄ±yor: ${name} yÃ¼kleniyor...`;
            
            audioPlayer.src = url;
            
            audioPlayer.onplaying = () => {
                 currentStationInfo.textContent = `Ã‡alÄ±nÄ±yor: ${name}`;
            };
            
            audioPlayer.play().catch(e => {
                console.log("Otomatik oynatma engellendi veya hata oluÅŸtu:", e);
                currentStationInfo.textContent = "Oynatmak iÃ§in 'Play' tuÅŸuna basÄ±n.";
            });
        }
    </script>
</body>
</html>
